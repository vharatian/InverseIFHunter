<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Hunter Dashboard</title>
    <!-- Base path for when served under /dashboard/ -->
    <script>window.BASE_PATH = window.location.pathname.includes('/dashboard') ? '/dashboard' : '';</script>
    <link rel="stylesheet" href="static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Model Hunter Dashboard</h1>
        <div class="header-controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search sessions, models, errors, responses..." 
                       onkeypress="if(event.key==='Enter') performSearch()">
                <button onclick="performSearch()">Search</button>
            </div>
            <select id="timeRange">
                <option value="1">Last 1 hour</option>
                <option value="6">Last 6 hours</option>
                <option value="24" selected>Last 24 hours</option>
                <option value="72">Last 3 days</option>
                <option value="168">Last 7 days</option>
            </select>
            <button id="refreshBtn" onclick="refreshAll()">Refresh</button>
            <span id="lastUpdate">--</span>
        </div>
    </header>

    <main>
        <!-- Search Results (hidden by default) -->
        <section class="panel full-width" id="searchResults" style="display: none;">
            <div class="panel-header">
                <h3>Search Results: <span id="searchQuery"></span></h3>
                <button onclick="clearSearch()" class="clear-btn">Clear Search</button>
            </div>
            <div class="search-results-list" id="searchResultsList"></div>
        </section>

        <!-- Overview Cards -->
        <section class="overview-cards">
            <div class="card">
                <div class="card-icon">üë•</div>
                <div class="card-content">
                    <div class="card-value" id="activeSessions">--</div>
                    <div class="card-label">Active Sessions (5 min)</div>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">üéØ</div>
                <div class="card-content">
                    <div class="card-value" id="totalHunts">--</div>
                    <div class="card-label">Total Hunts</div>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">üì°</div>
                <div class="card-content">
                    <div class="card-value" id="apiCalls">--</div>
                    <div class="card-label">API Calls</div>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">‚è±Ô∏è</div>
                <div class="card-content">
                    <div class="card-value" id="avgLatency">--</div>
                    <div class="card-label">Avg Latency</div>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">üíî</div>
                <div class="card-content">
                    <div class="card-value" id="breaksFound">--</div>
                    <div class="card-label">Breaks Found</div>
                </div>
            </div>
            <div class="card error-card">
                <div class="card-icon">‚ùå</div>
                <div class="card-content">
                    <div class="card-value" id="failedCalls">--</div>
                    <div class="card-label">Failed Calls</div>
                </div>
            </div>
        </section>

        <!-- Charts Row -->
        <section class="charts-row">
            <div class="chart-container">
                <h3>Activity Timeline</h3>
                <canvas id="timelineChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Model Usage</h3>
                <canvas id="modelChart"></canvas>
            </div>
        </section>

        <!-- Two Column Layout -->
        <section class="two-column">
            <!-- Live Feed -->
            <div class="panel">
                <div class="panel-header">
                    <h3>Live Feed</h3>
                    <select id="eventFilter">
                        <option value="">All Events</option>
                        <option value="session_created">Sessions</option>
                        <option value="hunt_start">Hunts</option>
                        <option value="api_call_start">API Calls</option>
                        <option value="api_call_end">API Results</option>
                        <option value="judge_call">Judge Calls</option>
                    </select>
                </div>
                <div class="event-list" id="eventList">
                    <div class="loading">Loading events...</div>
                </div>
            </div>

            <!-- Sessions List -->
            <div class="panel">
                <div class="panel-header">
                    <h3>Recent Sessions</h3>
                </div>
                <div class="session-list" id="sessionList">
                    <div class="loading">Loading sessions...</div>
                </div>
            </div>
        </section>

        <!-- Model Stats Table -->
        <section class="panel full-width">
            <div class="panel-header">
                <h3>Model Performance</h3>
            </div>
            <table class="model-table" id="modelTable">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Calls</th>
                        <th>Success Rate</th>
                        <th>Avg Latency</th>
                        <th>Failures</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" class="loading">Loading...</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Recent Errors -->
        <section class="panel full-width" id="errorsSection" style="display: none;">
            <div class="panel-header">
                <h3>Recent Errors</h3>
            </div>
            <div class="error-list" id="errorList"></div>
        </section>

        <!-- Cost Tracking -->
        <section class="panel full-width">
            <div class="panel-header">
                <h3>Cost Tracking (Estimated)</h3>
                <span class="cost-total" id="totalCost">$0.00</span>
            </div>
            <div class="cost-breakdown">
                <div class="cost-stats">
                    <div class="cost-stat">
                        <span class="cost-label">Total Tokens In:</span>
                        <span id="totalTokensIn">0</span>
                    </div>
                    <div class="cost-stat">
                        <span class="cost-label">Total Tokens Out:</span>
                        <span id="totalTokensOut">0</span>
                    </div>
                </div>
                <table class="cost-table" id="costTable">
                    <thead>
                        <tr>
                            <th>Provider/Model</th>
                            <th>Calls</th>
                            <th>Tokens In</th>
                            <th>Tokens Out</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="5" class="loading">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Detailed Views Tabs -->
        <section class="panel full-width">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="showTab('hunts')">Hunts</button>
                <button class="tab-btn" onclick="showTab('calls')">API Calls</button>
                <button class="tab-btn" onclick="showTab('breaks')">Breaks</button>
                <button class="tab-btn" onclick="showTab('failures')">Failures</button>
            </div>
            
            <!-- Hunts Tab -->
            <div class="tab-content active" id="tab-hunts">
                <div class="detail-list" id="huntsList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            
            <!-- API Calls Tab -->
            <div class="tab-content" id="tab-calls">
                <div class="detail-list" id="callsList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            
            <!-- Breaks Tab -->
            <div class="tab-content" id="tab-breaks">
                <div class="detail-list" id="breaksList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
            
            <!-- Failures Tab -->
            <div class="tab-content" id="tab-failures">
                <div class="detail-list" id="failuresList">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Model Hunter Dashboard v1.0 | Auto-refreshes every 30 seconds</p>
    </footer>

    <script src="static/dashboard.js"></script>
</body>
</html>
